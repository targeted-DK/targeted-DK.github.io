---
layout: post
title: "Temporal Capabilities : Access Control For Time"
date: 2024-12-22
categories: Systems Scheduling
---

# III. TCap System Model and Design
Tcaps와 여러 하위 시스템과 스레드 실행의 관계를 이해하기 위해 간단한 모델을 제시함. 시스템은 다수의 하위 시스템으로 구성되어 있으며, $s^{x} \in S$, 각 하위 시스템은 전체 시스템의 principals라고 지칭한다.(시간 소비자들). 각 하위 시스템의 스케쥴러는 그 하위 시스템에 존재하는 모든 스레드가 필요로하는 연산 자원을 정리하는데 책임을 가지고 있으며, 모든 하위시스템은 이러한 스케쥴링 서비스를 가지고 있다. 예시로는 가상 머신이나. hierarchial scheduling systems. 분리된 커널 등이 있다. Tcap의 경우 항상 모든 시간에 활성화 되어야 하며, 모든 processing time(처리 시간)은 활성화된 TCap과 연결됨. 각 스레드의 실행은 동적으로 TCap과 관련되어 있다. 각 하위 시스템 ($s^{x}$)는 TCap 세트에 capabtility가 통제된 접근을 가지고 있다. $T^{x} = {t_{1}^{x} ...}$

## TCaps Budget

각 Tcap은 $t_{n}^{x}$는 한도(budget)을 가지고 있으며, 이는 시간을 스칼라 값으로 나누어 하위 시스템에 cycles(주기) 할당한다. 이 한도는 스레드 실행에서 사영된다. Delegation(양도)는 한 개의 TCap에서 다른 비동기적인 종점 객체(다른 하위시스템)에 시간을 건네주는 역할을 한다. 예를들어, b 단위시간을 $t_{n}^{x}$에서 $t_{m}^{y}$을 양도할시, 주어진 한도는 아래와 같이 계산된다.
$B_{n}^{x} = B_{n}^{x} - b$ \\

$B_{m}^{y} = B_{m}^{y} + b$.
즉 각 TCap의 시간은 시스템이 제공하는것이 아니라 다른 TCap이 반드시 양도해야 한다.

TCap 중에서 Chronos($t^{c}$)라고 부르는 tcap이 존재하는데, 이는 우리가 신뢰할 수 있는 하위 시스템 $s^{c}$에서 $B^{c} = \infty$를 가진다. 다른 모든 TCaps 들이 한도를 모두 사용하였을때, $t^{c}$가 활성화 되면서 한도를 양도해 채우게 된다. 이 채우는 과정은 프로그램에 따라 시간에 맞춰 달라질 수 있다.

## TCaps Quality
각 TCap은 $Q_{n}^{x}$라는 quality를 가지고 있다. 이는 각 Tcap이 가지고 있는 시간의 중요성을 나타내는 지표이다. $Q_{n}^{x} = {p_{n}^{x}, Q_{n}^{y}}. 각 하위 시스템의 Tcap에 스칼라 값의 중요도를 각 시스템이 보유한 semantics를 활용하여 할당한다. 각 TCap의 quality는 각 하위시스템의 중요도에 맞춰 할당된 한도 $t_{n}^{x}$를 포함한다. 낮은 $p_{n}^{x}$ 값은 높은 quality를 의미한다.
TCap에서 높은 퀄리티는 선제 결정(preemption decisions)를 만들기 위해 사용된다. 비동기 이벤트(비동기 전송 또는 중단)가 $t_{n}^{x}$를 활성화하여 현재 스레드에  $t_{n}^{y}$을 이용하여 선제적으로 실행해야하는지 결정하며 이는  $Q_{n}^{x} > Q_{m}^{y}$인 경우에만 해당한다. Quality는 모든 시점에서 어떤 TCap을 실행해야하는지 결정하는게 아니며 스케쥴 결정을 내리기 위함이 아니다. 그래서 TCaps의 순서를 정의하기 위해 사용되지 않는다. 
![](/images/TCaps/3.png)
여기서 $Q_{n} > Q_{m}$ 또는  $Q_{m} > Q_{n}$ 둘 다 가능하지 않다. 이런 경우엔 두 개의 스케쥴러가 한 개의 TCap과 관련해 상대적 시간의 중요성에 대해 동의하지 않는 경우이다. TCap의 근본적인 목적은 local 우선도의 양도가 로컬 스레드에 할당된 한도를 방해하지 않는 것이다. 그래서 선제성은 모든 스케쥴러가 선제성이 필요하다고 동의할 경우 부여된다. 

잘못된 양도로 인한 방해를 방지하기 위해 quality의 양도는 각 하위 시스템에서 덜 우선시 되게 고안되었다. 
![](/images/TCaps/4.png)

위 공식에서는 하위 시스템에서 특정 스케쥴러의 시간적 우선도가 유지되며 transitive delegation(전이적 위임)에서 선제적 결정을 위해 사용된다. 이는 분산정보 흐름에서 label이 관리되는 형식과 비슷하다. 위 두 공식을 사용하여 중요한 TCap 성질을 알 수 있는데 이는, 로컬 하위 시스템 우선도가 전역적(global)인 선제 결정에 영향을 준다. 

## TCap Usage Example

![](/images/TCaps/2.png)
위 사진에서는 4개의 하위 시스템으로 구성된 간단한 시스템을 구현하였으며 간단한 양도 패턴이 사용된다. (a)에서는 부모에서 자식으로 양도되는 과정을 보여주며, (b)에서는 자식간 양도를 보여준다. ($s^{m}에서 s^{h}으로 I/O 요청). (a)에서, 1) $s^{m}$은 $s^{p}$과 $s^{h}$ 낮은 우선도가 부여됨(높은 숫자). 이는 비동기 전송이 $s^{h}$ 실행에 있어 방해하지 않을 것임을 알 수 있다. ($t_{0}^{m} /> t^{h}$). 2) 위 표에서 표현된 interrupt(방해)를 통해 $t_{1}^{m}$과 관련된 실행을 활성화하는 것은 선제적인 결정을 일으키지 않을 것이다. ($B_{1}^{m} 이기에). 3) 이러한 양도가 $T = M + N + L$ 주기마다 일어난다며, 하위 시스템의 사용률은 다음과 같다. $s^{h} : M/T$, $s^{l} : L/T$.
(b)부분에서 자식간 양도가 이루어 진 것을 볼 수 있는데. 이는 $s^{h}$가 $t_{1}^{m}$에 m 주기만큼 양도하여 I/O처리에 사용할 수 있도록 하였고, $t_{1}^{m}$ ($t_{1}^{m}$ > $t_{0}^{m}$), $s^{h}$ 관련된 interrupt(중단)은 $s^{m}$의 모든 실행보다 우선될 것이며,$s^{h}$의 모든 실행보다 우선될 것임($t_{0}^{m}$ > $t^{h}$). 하지만 $s^{p}$에서는 우선시 되지 않음($t_{1}^{m}$ > $t^{p}$). 자식 간 양도에서 볼 수 있듯이 $s^{m}$은 $s^{h}$의 실행을 m 주기 동안 preempt 될 수 있다. 이는 매우 중요한데, 이는 전통적으로 우선순위를 매길 때((a) 참고) $s^{m}$는 $s^{h}$보다 먼저 실행되지 않기 때문이다. $s^{h}$는 interference를 제한하여 $s^{m}$가 자신 만의 스레들을 소유하여 IO 요청을 처리를 만족시키기 위해 m을 조심히 선택하게 한다. 물론 이 어떤 $s^{p}$, $s^{h}$, $s^{m}$, $s^{l}$은 양도와 우선순위 재조정을 통해 $t_{1}^{m}$이 자신들의 스레드를 preempt하는 과정을 막을 수 잇으며, 이는 각 하위 시스템이 양도를 통해 확정된 시간의 실행을 다른 하위시스템의 실행 시간과 효율적으로 통합시킨다. 
